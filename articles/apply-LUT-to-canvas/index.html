<!DOCTYPE >
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>LUT apply color correction from CUBE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/articles/styles/highlight.css">
    <link rel="stylesheet" href="/articles/styles/header.css">
    <link rel="stylesheet" href="/articles/styles/content.css">
    <link rel="stylesheet" href="/articles/styles/markdown.css">
    <style rel="stylesheet">
      mjx-container[jax="SVG"] > svg {
         max-width: 100%;
      }
    </style>
    <link rel="stylesheet" href="/articles/styles/typography.css">
    
  </head>

  <body>
    <layout>
      <header>
        <h1>
          LUT apply color correction from CUBE
        </h1>
      </header>
      <main>
        <article class="markdown">
          <h2 class="shortDescription">This article explores how to apply LUT color correction to a canvas</h2>
          <div class="content">
            <style>
    .global-theme-select {
        position: sticky;
        top: 0;
        left: 0;
        z-index: 1000;
        font-size: 20px;
        width: 100%;
        background-color: white;
        padding-bottom: 10px;
    }
    .global-theme-select select {
        font-size: 50px;
    }
</style>
<div class="global-theme-select">
    <lut-selector><lut-selector>
</lut-selector></lut-selector></div>
<blockquote>
<p>This article contains interactive demos that respond to the selected color palette. Feel free to experiment with different palettes to see how the demos react.</p>
</blockquote>
<blockquote>
<p>Each demo is essentially an iframe pointing to a separate folder with its source code. You can open any of them in a debugger to explore how they work without interfering with other demos.
All demos are written in plain JavaScript without any build tools</p>
</blockquote>
<h2>Introduction</h2>
<p>Let's imagine we have an image or video and we need to remap the colors in it to match a specific color palette. This is a common task in animation and video production. In previous article we discussed how to apply color channel mapping algorithm.
The main problem with that that we would need to prepare assets in a specific way. It produces good results for simple media, but it is not very flexible.
In this article we will explor LUT (Look-Up Table) color correction. LUT is a table that maps one color to another. It can be used to remap colors in an image or video to match a specific color palette.</p>
<p>Let's dive into each approach.</p>
<h2>What is LUT?</h2>
<p>LUT (Look-Up Table) is a table that maps one color to another. It can be used to remap colors in an image or video to match a specific color palette. LUTs are commonly used in video editing and color grading software to apply color correction and effects to footage.</p>
<p>Let's look at a simple LUT data defined in a cube format. The cube format is a common format for LUTs and is used by many video editing and color grading software.</p>
<pre class="language-c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Created by Adobe Lightroom plugin Export <span class="token function">LUT</span> <span class="token punctuation">(</span><span class="token number">1.18</span><span class="token number">.0</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">www</span><span class="token expression"><span class="token punctuation">.</span>johnrellis<span class="token punctuation">.</span>com<span class="token operator">/</span>lightroom<span class="token operator">/</span>exportlut<span class="token punctuation">.</span>htm</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Preset<span class="token operator">:</span> Cinematic7</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">Color profile<span class="token operator">:</span> <span class="token operator">/</span>Library<span class="token operator">/</span>Application Support<span class="token operator">/</span>Adobe<span class="token operator">/</span>Color<span class="token operator">/</span>Profiles<span class="token operator">/</span>Recommended<span class="token operator">/</span>AdobeRGB1998<span class="token punctuation">.</span>icc</span></span>
LUT_3D_SIZE <span class="token number">32</span>
DOMAIN_MIN <span class="token number">0.0</span> <span class="token number">0.0</span> <span class="token number">0.0</span>
DOMAIN_MAX <span class="token number">1.0</span> <span class="token number">1.0</span> <span class="token number">1.0</span>
<span class="token number">0.000000</span> <span class="token number">0.000000</span> <span class="token number">0.000000</span>
<span class="token number">0.031159</span> <span class="token number">0.001862</span> <span class="token number">0.001190</span>
<span class="token number">0.062837</span> <span class="token number">0.003113</span> <span class="token number">0.002167</span>
<span class="token number">0.087587</span> <span class="token number">0.006531</span> <span class="token number">0.004181</span>
<span class="token number">0.113863</span> <span class="token number">0.012634</span> <span class="token number">0.010315</span></code></pre>
<h2>SVG filter imaplementation</h2>
<p><demo-with-playground file="./LUT-with-svg-filter/index.mjs" initialPath="./LUT-with-svg-filter/index.html"></demo-with-playground></p>
<h2>WebGL implementation</h2>
<p><demo-with-playground file="./LUT-with-webgl/index.mjs" initialPath="./LUT-with-webgl/index.html"></demo-with-playground></p>
<script src="index.mjs" type="module"></script>
          </div>
        </article>
      </main>
      <footer></footer>
    </layout>

    <script>
        function resizeIframe(iframe) {
            const height = parseInt(iframe.style.height);
            const scrollHeight = iframe.contentWindow.document.documentElement.scrollHeight
            iframe.style.height = scrollHeight + 'px';
            console.log(height, scrollHeight)
            if (height < scrollHeight) {  
              console.log('resize')
              iframe.style.height = scrollHeight + 20 + 'px';
            }
        }

        setInterval(() => {
            const iframes = document.querySelectorAll('iframe');
            iframes.forEach((iframe) => {
              resizeIframe(iframe);
            });
        }, 100);


    class DemoWithPlayground extends HTMLElement {
      static get observedAttributes() {
        return ['initialPath', 'file'];
      }

      constructor() {
          super();
              // this.attachShadow({ mode: 'open' });
          }

          connectedCallback() {
              this.render();
          }

          attributeChangedCallback() {
              this.render();
          }

          render() {
              const initialPath = this.getAttribute('initialPath') || '';
              const file = this.getAttribute('file') || '';
          
          this.innerHTML = `
          <div>
              <iframe src="./${initialPath}"></iframe>

              <a href="https://stackblitz.com/github/stepancar/articles/tree/main/articles/apply-LUT-to-canvas/?file=${file}&initialPath=${initialPath}&startScript=start" target="_blank">
              <img
                  alt="Open in StackBlitz"
                  src="https://developer.stackblitz.com/img/open_in_stackblitz.svg"
              />
              </a>
          </div>
          `;
          }
      }

    customElements.define('demo-with-playground', DemoWithPlayground);
    </script>
  </body>
</html>
