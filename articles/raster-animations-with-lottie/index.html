<!DOCTYPE >
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Downside of raster animations in Lottie</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/articles/css/style.css" type="text/css" media="screen">
    <link rel="stylesheet" href="/articles/styles/highlight.css">
    <link rel="stylesheet" href="/articles/styles/header.css">
    <link rel="stylesheet" href="/articles/styles/content.css">
    <link rel="stylesheet" href="/articles/styles/markdown.css">
    <link rel="stylesheet" href="/articles/styles/typography.css">
  </head>

  <body>
    <layout>
      <header>
        <h1>
          Downside of raster animations in Lottie
        </h1>
      </header>
      <main>
        <article class="markdown">
          <h2>This article explores the downsides of using Lottie for raster animations</h2>
          <div class="content">
            <style>
    .side-by-side {
        display: flex;
        justify-content: space-between;
        flex-direction: row;
    }

    .side-by-side iframe {
        width: 50%;
    }
</style>
<p>Lottie is a library that allows you to render animations in real-time using JSON files. It's a great tool for creating animations that are easy to share across different platforms. However, there are some downsides to using Lottie that you should be aware of. This article explains just one of them.</p>
<h2>Vector vs Raster animations</h2>
<p>Let's consider this animation:</p>
<p><demo-with-playground file="./demos/bouncing-heart-large/index.html" initialpath="./demos/bouncing-heart-large/index.html"></demo-with-playground></p>
<iframe src="demos/bouncing-heart-large/index.html"></iframe>
<a href="https://stackblitz.com/github/stepancar/articles/tree/main/articles/raster-animations-with-lottie/?file=/demos/bouncing-heart-large/index.html&initialPath=/demos/bouncing-heart-large/index.html&startScript=start" target="_blank">
  <img alt="Open in StackBlitz" src="https://developer.stackblitz.com/img/open_in_stackblitz.svg">
</a>
<p>You can see the source of this animation <a href="assets/bouncing-heart-large.json">here</a></p>
<p>In this animation you can see a simple bouncing heart. The animation is created using Lottie.</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"v"</span><span class="token operator">:</span> <span class="token string">"5.11.0"</span><span class="token punctuation">,</span>
  <span class="token property">"fr"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"op"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
  <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">244</span><span class="token punctuation">,</span>
  <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">196</span><span class="token punctuation">,</span>
  <span class="token property">"nm"</span><span class="token operator">:</span> <span class="token string">"Heart"</span><span class="token punctuation">,</span>
  <span class="token property">"ddd"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">"assets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"imgSeq_0"</span><span class="token punctuation">,</span>
      <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">410</span><span class="token punctuation">,</span>
      <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">364</span><span class="token punctuation">,</span>
      <span class="token property">"t"</span><span class="token operator">:</span> <span class="token string">"seq"</span><span class="token punctuation">,</span>
      <span class="token property">"u"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"p"</span><span class="token operator">:</span> <span class="token string">"data:image/png;base64,...."</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"imgSeq_1"</span><span class="token punctuation">,</span>
      <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">410</span><span class="token punctuation">,</span>
      <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">364</span><span class="token punctuation">,</span>
      <span class="token property">"t"</span><span class="token operator">:</span> <span class="token string">"seq"</span><span class="token punctuation">,</span>
      <span class="token property">"u"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"p"</span><span class="token operator">:</span> <span class="token string">"data:image/png;base64,...."</span>
    <span class="token punctuation">}</span>
    ...
    <span class="token punctuation">{</span>
      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"imgSeq_23"</span><span class="token punctuation">,</span>
      <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">410</span><span class="token punctuation">,</span>
      <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">364</span><span class="token punctuation">,</span>
      <span class="token property">"t"</span><span class="token operator">:</span> <span class="token string">"seq"</span><span class="token punctuation">,</span>
      <span class="token property">"u"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token property">"p"</span><span class="token operator">:</span> <span class="token string">"data:image/png;base64,...."</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>As you can see, animation contains 24 images. Each image is a base64 encoded PNG. This is a huge overhead for the animation. The size of the JSON file is 1.5MB. This is a lot for a simple animation.</p>
<p>this happened because the designer exported the animation as a sequence of images. This is a common mistake when working with Lottie. Instead of exporting the animation as a sequence of images, the designer should export it as a vector animation. This will reduce the size of the JSON file and improve the performance of the animation.</p>
<p>The problem is that in this specific case designer created this animation as raster animation explicitly, because it's hard to create animation with 3D effects in vector format. This is a common problem when working with Lottie. Designers often create animations in raster format because it's easier and faster, and on client side lottie player can handle both vector and raster animations with the same code base.
However, this can lead to performance issues and large file sizes.</p>
<p>This problem could be solved if lottie could store sequence of images in compressed format, like frames are stored in video files. This would reduce the size of the JSON file and improve the performance of the animation.</p>
<p>At this moment, lottie does not support this feature.</p>
<p>There is another library and format called <a href="https://dotlottie.io/">dotlottie</a>. They say that their format size is more efficient because it use binary format. But binary format would not help if we store all images independently. So, they actually can compress sequence of images.
The problem is that this is a custom, not free format. So, it's not widely supported.
Ideally, it should be a feature of lottie itself.</p>
<h2>What can we do?</h2>
<p>The only thing we can do is to educate designers to create animations in vector format instead of raster format. This will reduce the size of the JSON file and improve the performance of the animation.</p>
<p>for example, in this specific case, the designer could use just one raster frame and animate it's scale property.</p>
<p>Look at <a href="assets/compressed-heart-animation.json">this animation</a></p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
    <span class="token property">"v"</span><span class="token operator">:</span> <span class="token string">"5.11.0"</span><span class="token punctuation">,</span>
    <span class="token property">"fr"</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"op"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
    <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">335</span><span class="token punctuation">,</span>
    <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">240</span><span class="token punctuation">,</span>
    <span class="token property">"nm"</span><span class="token operator">:</span> <span class="token string">"Alfa Red Heart extra low"</span><span class="token punctuation">,</span>
    <span class="token property">"ddd"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"assets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"image_0"</span><span class="token punctuation">,</span>
            <span class="token property">"w"</span><span class="token operator">:</span> <span class="token number">410</span><span class="token punctuation">,</span>
            <span class="token property">"h"</span><span class="token operator">:</span> <span class="token number">364</span><span class="token punctuation">,</span>
            <span class="token property">"u"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"p"</span><span class="token operator">:</span> <span class="token string">"data:image/png;base64,..."</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"layers"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">"ddd"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"ind"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"ty"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token property">"nm"</span><span class="token operator">:</span> <span class="token string">"HEART_main_page_00011.png"</span><span class="token punctuation">,</span>
            <span class="token property">"cl"</span><span class="token operator">:</span> <span class="token string">"png"</span><span class="token punctuation">,</span>
            <span class="token property">"refId"</span><span class="token operator">:</span> <span class="token string">"image_0"</span><span class="token punctuation">,</span> <span class="token comment">// reference to image asset</span>
            <span class="token property">"sr"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"ks"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                ...
                <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// scale key frames</span>
                    <span class="token property">"a"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token property">"k"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"i"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.08</span><span class="token punctuation">,</span>
                                    <span class="token number">0.08</span><span class="token punctuation">,</span>
                                    <span class="token number">0.25</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">1.022</span><span class="token punctuation">,</span>
                                    <span class="token number">1.024</span><span class="token punctuation">,</span>
                                    <span class="token number">1</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"o"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.31</span><span class="token punctuation">,</span>
                                    <span class="token number">0.31</span><span class="token punctuation">,</span>
                                    <span class="token number">0.75</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"t"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                            <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">100</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"i"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.188</span><span class="token punctuation">,</span>
                                    <span class="token number">0.188</span><span class="token punctuation">,</span>
                                    <span class="token number">0.25</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">1</span><span class="token punctuation">,</span>
                                    <span class="token number">1</span><span class="token punctuation">,</span>
                                    <span class="token number">1</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"o"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.5</span><span class="token punctuation">,</span>
                                    <span class="token number">0.5</span><span class="token punctuation">,</span>
                                    <span class="token number">0.75</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.003</span><span class="token punctuation">,</span>
                                    <span class="token number">0.004</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"t"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                            <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token number">56.8</span><span class="token punctuation">,</span>
                                <span class="token number">57.8</span><span class="token punctuation">,</span>
                                <span class="token number">100</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"i"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.399</span><span class="token punctuation">,</span>
                                    <span class="token number">0.399</span><span class="token punctuation">,</span>
                                    <span class="token number">0.25</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.997</span><span class="token punctuation">,</span>
                                    <span class="token number">0.997</span><span class="token punctuation">,</span>
                                    <span class="token number">1</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"o"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.5</span><span class="token punctuation">,</span>
                                    <span class="token number">0.5</span><span class="token punctuation">,</span>
                                    <span class="token number">0.75</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"t"</span><span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>
                            <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">100</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"i"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.163</span><span class="token punctuation">,</span>
                                    <span class="token number">0.163</span><span class="token punctuation">,</span>
                                    <span class="token number">0.25</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.8</span><span class="token punctuation">,</span>
                                    <span class="token number">0.777</span><span class="token punctuation">,</span>
                                    <span class="token number">1</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"o"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token property">"x"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.2</span><span class="token punctuation">,</span>
                                    <span class="token number">0.2</span><span class="token punctuation">,</span>
                                    <span class="token number">0.75</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                                <span class="token property">"y"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                    <span class="token number">0.005</span><span class="token punctuation">,</span>
                                    <span class="token number">0.005</span><span class="token punctuation">,</span>
                                    <span class="token number">0</span>
                                <span class="token punctuation">]</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            <span class="token property">"t"</span><span class="token operator">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                            <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token number">58.8</span><span class="token punctuation">,</span>
                                <span class="token number">59.8</span><span class="token punctuation">,</span>
                                <span class="token number">100</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token property">"t"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                            <span class="token property">"s"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">68.8</span><span class="token punctuation">,</span>
                                <span class="token number">100</span>
                            <span class="token punctuation">]</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">"ix"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
                    <span class="token property">"l"</span><span class="token operator">:</span> <span class="token number">2</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">"ao"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"ip"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"op"</span><span class="token operator">:</span> <span class="token number">31</span><span class="token punctuation">,</span>
            <span class="token property">"st"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"bm"</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"markers"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"props"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code></pre>
<p>As you can see, visually it looks similar to the previous animation, but the size of the JSON file is 30 times smaller. This is a huge improvement.</p>
<iframe src="demos/bouncing-heart-optimized/index.html"></iframe>
<a href="https://stackblitz.com/github/stepancar/articles/tree/main/articles/raster-animations-with-lottie/?file=/demos/bouncing-heart-large/index.html&initialPath=/demos/bouncing-heart-large/index.html&startScript=start" target="_blank">
  <img alt="Open in StackBlitz" src="https://developer.stackblitz.com/img/open_in_stackblitz.svg">
</a>
<p>You can compare them visually side by side</p>
<div class="side-by-side">
    <iframe src="demos/bouncing-heart-large/index.html"></iframe>
    <iframe src="demos/bouncing-heart-optimized/index.html"></iframe>
</div>

          </div>
        </article>
      </main>
      <footer></footer>
    </layout>

    <script>
      const iframes = document.querySelectorAll('iframe');
      debugger;
      iframes.forEach(iframe => {
          function resizeIframe() {
              const height = parseInt(iframe.style.height);
              const scrollHeight = iframe.contentWindow.document.documentElement.scrollHeight
              iframe.style.height = scrollHeight + 'px';
              console.log(height, scrollHeight)
              if (height < scrollHeight) {  
                console.log('resize')
                iframe.style.height = scrollHeight + 20 + 'px';
              }
          }

          iframe.onload = () => {
              resizeIframe(); // Initial resize after content load
          };

          setInterval(() => {
              resizeIframe();
          }, 100);
      });
    </script>
  </body>
</html>
